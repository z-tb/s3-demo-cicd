name: Upload Contacts JSON to S3
on:
  push:    
    branches:
      # only run when this branch is pushed to
      - json-upload

  # can run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  s3-upload:
    runs-on: ubuntu-latest

    # get runtime variables/secrets from this environmnet configuration
    environment: tb-test
  
    env:
      AWS_ACCESS_KEY_ID     : ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY : ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      AWS_REGION            : ${{ vars.AWS_REGION }}
      S3_TARGET             : s3-demo-alpha-zulu
      SRC_FILE              : ficticious-contacts.json
      WORK_DIR              : repo
      GH_REPO               : s3-demo-cicd
      GH_ACCT               : z-tb

    steps:
      # checkout the github repo onto the runner into a directory named 'repo'
      - name: Checkout
        uses: actions/checkout@v2
        with:
          repository: ${{ env.GH_ACCT }}/${{ env.GH_REPO }}
     
      - name: ls repo
        run: ls -lart ${GITHUB_WORKSPACE}

      - name: upload to s3
        run: aws s3 cp ${GITHUB_WORKSPACE}/${SRC_FILE} s3://${S3_TARGET}   
            

